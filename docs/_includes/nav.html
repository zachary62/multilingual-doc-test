{% comment %}
  Custom navigation that filters pages based on the current page's language (lang property).
{% endcomment %}

{% assign current_lang = page.lang | default: site.defaults[0].values.lang %}

{% if current_lang %}
  {% comment %} Get all pages, filter by current language, filter out excludes, ensure they have nav_order, and sort %}
  {% assign lang_pages = site.pages | where_exp: "item", "item.lang == current_lang"
                           | where_exp: "item", "item.nav_exclude != true"
                           | where_exp: "item", "item.nav_order"
                           | sort: "nav_order" %}

  <ul class="nav-list">
    {% for node in lang_pages %}
      {% if node.title and node.nav_order %}
        <li class="nav-list-item{% if page.url == node.url %} active{% endif %}">
          <a href="{{ node.url | absolute_url }}" class="nav-list-link">{{ node.title }}</a>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
{% else %}
  <p class="text-grey-lt-300"><em>Navigation error: Current page does not have a language (lang) set.</em></p>
{% endif %} 